{% extends "base.html" %}

{% block title %}ãƒã‚¤ãƒšãƒ¼ã‚¸ - é›»åŠ›å£²è²·ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ {% endblock %}

{% block content %}
<h1 class="section-title">ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>

<div style="margin-bottom: 3rem;">
    <h2>ã‚ˆã†ã“ãã€{{ current_user.username }}ã•ã‚“</h2>
    <p>ç™»éŒ²æ—¥: {{ current_user.created_at.strftime('%Yå¹´%mæœˆ%dæ—¥') }}</p>
</div>

<h2 class="section-title">ã‚ãªãŸã®å‡ºå“</h2>
<div class="card-grid">
    {% for listing in listings %}
        <a href="{{ url_for('main.listing_detail', id=listing.id) }}" style="text-decoration: none; color: inherit;">
            <div class="card" style="cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
                <h3>{{ listing.title }}</h3>
                <p>{{ listing.description[:100] }}{% if listing.description|length > 100 %}...{% endif %}</p>
                <div class="listing-meta">
                    <span>ğŸ”‹ {{ listing.power_amount }}kWh</span>
                    <span>ğŸ“ {{ listing.location }}</span>
                    <span>ğŸ“… {{ listing.created_at.strftime('%m/%d') }}</span>
                    <span style="color: {% if listing.is_active %}green{% else %}red{% endif %};">
                        {% if listing.is_active %}å…¬é–‹ä¸­{% else %}éå…¬é–‹{% endif %}
                    </span>
                </div>
                <div class="price">Â¥{{ "%.2f"|format(listing.price_per_kwh) }}/kWh</div>
            </div>
        </a>
    {% else %}
        <p>ã¾ã å‡ºå“ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<a href="{{ url_for('main.new_listing') }}">æ–°è¦å‡ºå“ã‚’ä½œæˆ</a></p>
    {% endfor %}
</div>

<h2 class="section-title">ã‚ãªãŸã®è²·å–ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h2>
<div class="card-grid">
    {% for request in requests %}
        <div class="card">
            <h3><a href="{{ url_for('main.request_detail', id=request.id) }}" style="text-decoration: none; color: inherit;">{{ request.title }}</a></h3>
            <p>{{ request.description[:100] }}{% if request.description|length > 100 %}...{% endif %}</p>
            <div class="listing-meta">
                <span>ğŸ”‹ {{ request.power_amount }}kWh</span>
                <span>ğŸ“ {{ request.location }}</span>
                <span>ğŸ“… {{ request.created_at.strftime('%m/%d') }}</span>
                <span style="color: {% if request.is_active %}green{% else %}red{% endif %};">
                    {% if request.is_active %}å…¬é–‹ä¸­{% else %}éå…¬é–‹{% endif %}
                </span>
            </div>
            <div class="price">æœ€å¤§ Â¥{{ "%.2f"|format(request.max_price_per_kwh) }}/kWh</div>
        </div>
    {% else %}
        <p>ã¾ã è²·å–ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚<a href="{{ url_for('main.new_request') }}">æ–°è¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆ</a></p>
    {% endfor %}
</div>

<h2 class="section-title">è³¼å…¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</h2>
<div class="card-grid">
    {% for purchase_request in purchase_requests %}
        <div class="card">
            <h3><a href="{{ url_for('main.listing_detail', id=purchase_request.listing_id) }}" style="text-decoration: none; color: inherit;">{{ purchase_request.listing.title }}</a></h3>
            <div class="listing-meta">
                <span>è³¼å…¥å¸Œæœ›è€…: <strong><a href="{{ url_for('main.user_profile', user_id=purchase_request.buyer_id) }}" style="color: #ff4757; text-decoration: none;">{{ purchase_request.buyer.username }}</a></strong></span>
                <span>ğŸ“… {{ purchase_request.created_at.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}</span>
                <span style="color: 
                    {% if purchase_request.status == 'pending' %}orange
                    {% elif purchase_request.status == 'accepted' %}green
                    {% else %}red{% endif %};">
                    {% if purchase_request.status == 'pending' %}å¾…æ©Ÿä¸­
                    {% elif purchase_request.status == 'accepted' %}æ‰¿èªæ¸ˆã¿
                    {% else %}æ‹’å¦{% endif %}
                </span>
            </div>
            {% if purchase_request.message %}
                <p><strong>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> {{ purchase_request.message }}</p>
            {% endif %}
            <div style="margin-top: 1rem;">
                <a href="{{ url_for('main.chat_room', user_id=purchase_request.buyer_id) }}" class="btn btn-primary">ãƒãƒ£ãƒƒãƒˆã§è¿”ä¿¡</a>
            </div>
        </div>
    {% else %}
        <p>è³¼å…¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endfor %}
</div>
{% endblock %}