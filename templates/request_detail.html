{% extends "base.html" %}

{% block title %}{{ request.title }} - é›»åŠ›å£²è²·ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ {% endblock %}

{% block content %}
<div class="card">
    <h1>{{ request.title }}</h1>
    
    <div class="listing-meta">
        <span>è²·ã„æ‰‹: <strong>{{ request.buyer.username }}</strong></span>
        <span>ğŸ”‹ {{ request.power_amount }}kWh</span>
        <span>ğŸ“ {{ request.location }}</span>
        <span>ğŸ“… {{ request.created_at.strftime('%Yå¹´%mæœˆ%dæ—¥') }}</span>
    </div>
    
    <div class="price" style="font-size: 2rem; margin: 1rem 0;">
        æœ€å¤§ Â¥{{ "%.2f"|format(request.max_price_per_kwh) }}/kWh
    </div>
    
    <p><strong>å¿…è¦æœŸé–“:</strong> 
        {{ request.needed_from.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }} ã€œ 
        {{ request.needed_until.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}
    </p>
    
    <div style="margin: 2rem 0;">
        <h3>è©³ç´°èª¬æ˜</h3>
        <p>{{ request.description }}</p>
    </div>
    
    {% if current_user.is_authenticated and current_user.id != request.buyer_id %}
        <div style="margin: 2rem 0;">
            <a href="{{ url_for('main.send_message', user_id=request.buyer_id) }}" 
               class="btn btn-primary">è²·ã„æ‰‹ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹</a>
        </div>
    {% endif %}
</div>

<div class="comment-section">
    <h3>ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
    
    {% if current_user.is_authenticated %}
        <div class="card">
            <form method="POST" action="{{ url_for('main.add_comment') }}">
                <input type="hidden" name="request_id" value="{{ request.id }}">
                <div class="form-group">
                    <textarea name="content" class="form-control" rows="3" 
                              placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹</button>
            </form>
        </div>
    {% else %}
        <p><a href="{{ url_for('auth.login') }}">ãƒ­ã‚°ã‚¤ãƒ³</a>ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã§ãã¾ã™ã€‚</p>
    {% endif %}
    
    {% for comment in comments %}
        <div class="comment">
            <div class="comment-author">{{ comment.author.username }}</div>
            <div class="comment-date">{{ comment.created_at.strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') }}</div>
            <p>{{ comment.content }}</p>
        </div>
    {% else %}
        <p>ã¾ã ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endfor %}
</div>
{% endblock %}